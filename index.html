<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>googleBooksAPI</title>
  <link rel="stylesheet" href="style.css">
  
</head>

<body>

<header>
  <div class="header-container">
    <div class="logo">わたしの本棚</div>
    <div class="search-bar">
      <input type="text" name="" id="chat-input" placeholder="登録する本のキーワードを入力">
      <button id="btn">検索</button>
    </div>
    <div>
      <div class="nav-icons">
        <span>アカウント</span>
        <span>カレンダー</span>
      </div>
    </div>
  </div>
</header>

<div id="output"></div>

<!-- モーダル -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>  <!--×ボタン-->>
    <h2>本の新規登録</h2>
    <p><strong>タイトル:</strong> <span id="modal-title"></span></p>
    <p><strong>著者:</strong> <span id="modal-authors"></span></p>
    <p><strong>ページ数:</strong> <span id="modal-pages"></span></p>
    <button id="register-btn">登録</button>
  </div>
</div>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script type="module">
  // Firebaseモジュールのインポート
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js';
  import { 
    getFirestore,
    collection,
    addDoc,
    orderBy,
    serverTimestamp,
    onSnapshot, //データを取ってくる
    query,
    limit,
    getDocs, //データを取ってくる
    updateDoc,
    doc
  } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js';
 

  const firebaseConfig = {
    apiKey: "AIzaSyALMFGtU4yDeqKo7j4ROWimWsLp581-Mg0",
    authDomain: "bookapp-af497.firebaseapp.com",
    projectId: "bookapp-af497",
    storageBucket: "bookapp-af497.appspot.com",
    messagingSenderId: "441851565990",
    appId: "1:441851565990:web:03cb7a74b4058e5dec6167"
  };

  // Firebaseの初期化
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 検索ボタンのクリックイベント
    document.getElementById('btn').addEventListener('click', function() {
      const keyword = document.getElementById('chat-input').value;
      const url = `https://www.googleapis.com/books/v1/volumes?q=${keyword}&maxResults=5`;


   axios
      .get(url)
      .then(function (response) {
      // リクエスト成功時の処理（responseに結果が入っている）
      console.log(response.data.items[0].volumeInfo.title);
      const books = []; //検索結果を格納
      response.data.items.forEach(function(book) {
        const bookInfo = book.volumeInfo;
        books.push(`
            <div class="book" onclick="showDetail('${bookInfo.title}', '${bookInfo.authors ? bookInfo.authors.join(", ") : ''}', '${bookInfo.pageCount}', '${bookInfo.imageLinks ? bookInfo.imageLinks.thumbnail : ''}')">
              <img src="${bookInfo.imageLinks ? bookInfo.imageLinks.thumbnail : ''}" alt="${bookInfo.title}">
              <p>${bookInfo.title}</p>
            </div>  
            `);
      });
      document.getElementById('output').innerHTML = books.join('');
  })

  .catch(function (error) {
    // リクエスト失敗時の処理（errorにエラー内容が入っている）
    console.log(error);
  })
  .finally(function () {
    // 成功失敗に関わらず必ず実行
    console.log("done!");
  });


    });

  //モーダルを表示して本の詳細と登録
  // windows でグローバルスコープに公開し、上記のクリックイベント時にも呼び出せるようにするのがポイント。
  window.showDetail = function showDetail(title, author, pages, imageUrl) {
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-authors').textContent = author;
    document.getElementById('modal-pages').textContent = pages;
    document.getElementById('myModal').style.display = 'block'; //モーダル全体の表示。block により隠れていたモーダルが表示できる

    document.getElementById('register-btn').onclick = function () {
      const book = {
        title: title,
        author: author,
        pages: pages,
        imageUrl: imageUrl
      };

    }
  };

  // ×で閉じる処理
  document.querySelector('.close').addEventListener('click', function() {
    document.getElementById('myModal').style.display = 'none';
  });



  </script>
</body>

</html>